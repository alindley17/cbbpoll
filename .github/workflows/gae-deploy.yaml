on:
  push:
    branches: master

name: Deploy to Google App Engine

jobs:
  deploy:
    name: Deploy to Google App Engine
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: Make private key file
        uses: jdharms/create-file@master
        with:
          file_contents: ${{ secrets.JWT_PRIV_KEY }}
          file_name: 'backend/jwtRS256.key'

      - name: Make public key file
        uses: jdharms/create-file@master
        with:
          file_contents: ${{ secrets.JWT_PUB_KEY }}
          file_name: 'backend/jwtRS256.key'

      - name: Google Cloud Auth
        uses: actions/gcloud/auth@master
        env:
          GCLOUD_AUTH: ${{ secrets.GCLOUD_AUTH }}

      - name: Google Cloud Deploy
        uses: actions/gcloud/cli@master
        with:
          args: --quiet app deploy backend
        env:
          CLOUDSDK_CORE_PROJECT: ${{ secrets.GCLOUD_PROJECT }}
